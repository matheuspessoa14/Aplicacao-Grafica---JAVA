package br.senac.rj.banco.janelas;

import java.awt.Container;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;

import javax.swing.JButton;
import javax.swing.JFrame;
import javax.swing.JLabel;
import javax.swing.JOptionPane;
import javax.swing.JTextField;
import javax.swing.WindowConstants;

import br.senac.rj.banco.modelo.ParticipanteDAO;

public class JanelaParticipante {
    public static JFrame criarJanelaParticipante() {
        JFrame janela = new JFrame("Atualização de Participante");
        janela.setResizable(false);
        janela.setDefaultCloseOperation(WindowConstants.DISPOSE_ON_CLOSE);
        janela.setSize(500, 350);

        Container caixa = janela.getContentPane();
        caixa.setLayout(null);

        // Labels
        JLabel labelId = new JLabel("ID do Participante:");
        JLabel labelNome = new JLabel("Nome:");
        JLabel labelEmail = new JLabel("Email:");
        JLabel labelTelefone = new JLabel("Telefone:");
        JLabel labelTipoIngresso = new JLabel("Tipo do Ingresso:");

        labelId.setBounds(30, 30, 140, 20);
        labelNome.setBounds(30, 70, 140, 20);
        labelEmail.setBounds(30, 110, 140, 20);
        labelTelefone.setBounds(30, 150, 140, 20);
        labelTipoIngresso.setBounds(30, 190, 140, 20);

        // TextFields
        JTextField jTextId = new JTextField();
        JTextField jTextNome = new JTextField();
        JTextField jTextEmail = new JTextField();
        JTextField jTextTelefone = new JTextField();
        JTextField jTextTipoIngresso = new JTextField();

        jTextId.setBounds(180, 30, 100, 20);
        jTextNome.setBounds(180, 70, 250, 20);
        jTextEmail.setBounds(180, 110, 250, 20);
        jTextTelefone.setBounds(180, 150, 250, 20);
        jTextTipoIngresso.setBounds(180, 190, 250, 20);

        // Campos inicialmente desabilitados (exceto id)
        jTextNome.setEnabled(false);
        jTextEmail.setEnabled(false);
        jTextTelefone.setEnabled(false);
        jTextTipoIngresso.setEnabled(false);

        // Botões
        JButton botaoConsultar = new JButton("Consultar");
        JButton botaoGravar = new JButton("Gravar");
        JButton botaoLimpar = new JButton("Limpar");

        botaoConsultar.setBounds(300, 30, 120, 20);
        botaoGravar.setBounds(100, 250, 100, 25);
        botaoLimpar.setBounds(260, 250, 100, 25);

        botaoGravar.setEnabled(false);

        // Adiciona componentes
        janela.add(labelId);
        janela.add(labelNome);
        janela.add(labelEmail);
        janela.add(labelTelefone);
        janela.add(labelTipoIngresso);

        janela.add(jTextId);
        janela.add(jTextNome);
        janela.add(jTextEmail);
        janela.add(jTextTelefone);
        janela.add(jTextTipoIngresso);

        janela.add(botaoConsultar);
        janela.add(botaoGravar);
        janela.add(botaoLimpar);

        // DAO
        ParticipanteDAO participante = new ParticipanteDAO();

        // Ação consultar
        botaoConsultar.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent e) {
                try {
                    int id = Integer.parseInt(jTextId.getText());
                    botaoGravar.setEnabled(true);

                    if (!participante.consultarParticipante(id)) {
                        jTextNome.setText("");
                        jTextEmail.setText("");
                        jTextTelefone.setText("");
                        jTextTipoIngresso.setText("");
                    } else {
                        jTextNome.setText(participante.getNome());
                        jTextEmail.setText(participante.getEmail());
                        jTextTelefone.setText(participante.getTelefone());
                        jTextTipoIngresso.setText(participante.getTipoIngresso());
                    }

                    jTextId.setEnabled(false);
                    jTextNome.setEnabled(true);
                    jTextEmail.setEnabled(true);
                    jTextTelefone.setEnabled(true);
                    jTextTipoIngresso.setEnabled(true);
                    botaoConsultar.setEnabled(false);
                    jTextNome.requestFocus();
                } catch (Exception ex) {
                    JOptionPane.showMessageDialog(janela, "Preencha o campo ID corretamente!");
                }
            }
        });

        // Ação gravar
        botaoGravar.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent e) {
                int resposta = JOptionPane.showConfirmDialog(janela, "Deseja salvar o participante?", "Confirmação",
                        JOptionPane.YES_NO_OPTION);
                if (resposta == JOptionPane.YES_OPTION) {
                    int id = Integer.parseInt(jTextId.getText());
                    String nome = jTextNome.getText().trim();
                    String email = jTextEmail.getText().trim();
                    String telefone = jTextTelefone.getText().trim();
                    String tipoIngresso = jTextTipoIngresso.getText().trim();

                    if (nome.isEmpty()) {
                        JOptionPane.showMessageDialog(janela, "Preencha o campo Nome.");
                        jTextNome.requestFocus();
                    } else {
                        boolean existe = participante.consultarParticipante(id);
                        boolean sucesso;
                        if (!existe) {
                            sucesso = participante.cadastrarParticipante(nome, email, telefone, tipoIngresso);
                            JOptionPane.showMessageDialog(janela,
                                    sucesso ? "Participante cadastrado com sucesso!" : "Erro ao cadastrar participante.");
                        } else {
                            sucesso = participante.atualizarParticipante(id, nome, email, telefone, tipoIngresso);
                            JOptionPane.showMessageDialog(janela,
                                    sucesso ? "Participante atualizado com sucesso!" : "Erro ao atualizar participante.");
                        }
                    }
                }
            }
        });

        // Ação limpar
        botaoLimpar.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent e) {
                jTextId.setText("");
                jTextNome.setText("");
                jTextEmail.setText("");
                jTextTelefone.setText("");
                jTextTipoIngresso.setText("");

                jTextId.setEnabled(true);
                jTextNome.setEnabled(false);
                jTextEmail.setEnabled(false);
                jTextTelefone.setEnabled(false);
                jTextTipoIngresso.setEnabled(false);

                botaoConsultar.setEnabled(true);
                botaoGravar.setEnabled(false);
                jTextId.requestFocus();
            }
        });

        return janela;
    }
}
